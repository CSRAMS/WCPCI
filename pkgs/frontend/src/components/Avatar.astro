---
import { teraIf, variable } from "@/lib/tera";
import type { HTMLAttributes } from "astro/types";

export interface Props extends HTMLAttributes<"img"> {
    userVar?: string;
    name?: string;
    size?: number;
    noTemplate?: boolean;
}

const {
    name,
    userVar = "user",
    size = 40,
    noTemplate = false,
    class: className,
    ...rest
}: Props = Astro.props;

export const getSrc = (userVar: string, size: number) => {
    return import.meta.env.DEV
        ? `https://gravatar.com/avatar/5aec02087368de589b8d33275c370ca7e876c956006aebc96d1bbc6c90e5e340?size=${size}&d=identicon&r=pg`
        : teraIf(
              `${userVar}.profile_picture_source == 'github' and ${userVar}.github_id`,
              `https://avatars.githubusercontent.com/u/${variable(`${userVar}.github_id`)}?s=${size}&v=4`,
              variable(`gravatar(email=${userVar}.email, size=${size})`)
          );
};

const src = noTemplate ? "" : getSrc(userVar, size);
---

<img
    class:list={[
        "rounded-full border-2 border-transparent bg-secondary-300 text-transparent",
        className ?? ""
    ]}
    crossorigin="anonymous"
    width={size}
    height={size}
    loading="lazy"
    src={src}
    alt={`${name ?? variable("name")}'s Avatar'`}
    {...rest}
/>
